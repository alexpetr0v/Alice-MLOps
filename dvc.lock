schema: '2.0'
stages:
  remove_bad_data:
    cmd:
    - python -m src.data.remove_bad_data data/raw/train_sessions.csv data/interim/clean_train_sessions.csv
    deps:
    - path: data/raw/train_sessions.csv
      md5: 7e8b612ba5eb9463972ed991e3e79068
      size: 60526801
    - path: src/data/remove_bad_data.py
      md5: 9879affb59aeba52b2d162702f138e18
      size: 825
    outs:
    - path: data/interim/clean_train_sessions.csv
      md5: 584ac6df6b0618274495d9abaa394dc2
      size: 65089022
  add_missing_data:
    cmd:
    - python -m src.data.add_missing_data data/interim/clean_train_sessions.csv data/interim/add_missing_train_sessions.csv
    deps:
    - path: data/interim/clean_train_sessions.csv
      md5: 584ac6df6b0618274495d9abaa394dc2
      size: 65089022
    - path: src/data/add_missing_data.py
      md5: f9b81152c5bd91a86b48d2d428971f84
      size: 1331
    outs:
    - path: data/interim/add_missing_train_sessions.csv
      md5: e912e7587b8e464fa707e70e8066a10c
      size: 68597356
  build_features_pipeline:
    cmd:
    - python -m src.features.build_features_pipeline data/interim/add_missing_train_sessions.csv
      data/interim/data_features.npz models/interim/build_features_transformer.pkl
    deps:
    - path: data/interim/add_missing_train_sessions.csv
      md5: e912e7587b8e464fa707e70e8066a10c
      size: 68597356
    - path: src/features/build_categorical_features.py
      md5: b1086ee0d18b6771b1bed63e2758113d
      size: 831
    - path: src/features/build_features_pipeline.py
      md5: 877a12d857622de7f9293e5c9e14332f
      size: 1904
    - path: src/features/build_numeric_features.py
      md5: 2afaad67a2c31a27251f721ebcd3807a
      size: 1717
    outs:
    - path: data/interim/data_features.npz
      md5: 99e5c6b1551634a6348529a00fc0e9bc
      size: 2688803
    - path: models/interim/build_features_transformer.pkl
      md5: 8993e7e18b4626b7e759259b84e6a72f
      size: 3255
  build_vectorizer_pipeline:
    cmd:
    - python -m src.features.build_vectorizer_pipeline data/interim/add_missing_train_sessions.csv
      data/interim/vect_train_data.npz models/interim/build_vect_transformer.pkl
    deps:
    - path: data/interim/add_missing_train_sessions.csv
      md5: e912e7587b8e464fa707e70e8066a10c
      size: 68597356
    - path: src/features/build_vectorizer.py
      md5: e30592ab41133c2ec24d147c596607ae
      size: 710
    - path: src/features/build_vectorizer_pipeline.py
      md5: de36e95d48223090321405b252d3b5aa
      size: 1496
    outs:
    - path: data/interim/vect_train_data.npz
      md5: b4e026805c4ceeb5b7d037eaa612585b
      size: 33446024
    - path: models/interim/build_vect_transformer.pkl
      md5: ca1a3322fc3cff55b26caa5e06063fda
      size: 16250508
  build_preferences_pipeline:
    cmd:
    - python -m src.features.build_preferences_pipeline data/raw/site_dic.pkl data/interim/add_missing_train_sessions.csv
      data/interim/data_preferences.csv models/interim/build_pref_transformer.pkl
    deps:
    - path: data/interim/add_missing_train_sessions.csv
      md5: e912e7587b8e464fa707e70e8066a10c
      size: 68597356
    - path: data/raw/site_dic.pkl
      md5: cfcc0d66c975152f16eb4b83bb77269f
      size: 1800682
    - path: src/features/build_preference_features.py
      md5: 97768f129935bc0d97743d824b03d250
      size: 2540
    - path: src/features/build_preferences_pipeline.py
      md5: 34ddb9280ed4ac67930d6de07318b44c
      size: 1937
    outs:
    - path: data/interim/data_preferences.csv
      md5: 88e86ae514e58e5d265dca89db0290e5
      size: 12576410
    - path: models/interim/build_pref_transformer.pkl
      md5: 6932e6dcc0272363d8ea0ec1d53dff05
      size: 1465141
  extract_target:
    cmd:
    - python -m src.data.extract_target data/interim/add_missing_train_sessions.csv
      data/processed/target.csv
    deps:
    - path: data/interim/add_missing_train_sessions.csv
      md5: e912e7587b8e464fa707e70e8066a10c
      size: 68597356
    - path: src/data/extract_target.py
      md5: 67dc05437d6c6253e80e64dde0e7603a
      size: 651
    outs:
    - path: data/processed/target.csv
      md5: 0cc8bad39d992e79a1503f729d45f6b3
      size: 2562449
